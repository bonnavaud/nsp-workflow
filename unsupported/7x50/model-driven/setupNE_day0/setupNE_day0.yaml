version: '2.0'

setupNE_day0:
  type: direct

  description: SetupNE Day 0 (using SNMPv2)

  tags:
    - demo workflow by NOKIA

  workflow_meta:
    title:   7750SR Device Commissioning with SNMPv2
    author:  NOKIA DEMO
    signature: 21657805e35b0b4fa7f8f544987eaf1496a8696504afd1a67054506a8c46328dd31d3a384d34c31fea341281431e22fc8012890bb4144be0e888518daee73b8bac1892c876ba881c586aee8c407146473198e22dfda3cbb0896c307954551ddd4b26de9966211cce515bebdbc884508b68405c2b001f21671e66a90ede7a3eea4862dd483baf4b8e64dde853b32c8a2a967a77554e123ccbe5b74402d3ef5d9b00ea8a2a27a20469881524fe759c949e2424df81f5cac8c45a96cbc79b24a5b75a35ad89f0275c3675591101e1133b3c83e00d5bd48676512aa402b176c5d936bba33303cf93ce057c0af694cbcefbfccd187316c29c6b859051c4d4b5a14672
    version: '1.0.0'
    license: BSD-3
    package: SROS Automation
    deprecated: false

  input:
    - token_auth:
    - mgmtIP:
    - systemIP:
    - neName:

  output:
    result: done

  output-on-error:
    result: failed

  tasks:
    configure_node_classic:
      action: nsp.sr_cli
      input:
        host: '<% $.mgmtIP %>'
        username: admin
        password: admin
        cmd:
          - /!classic-cli
          - configure system name "<% $.neName %>"
          - configure router interface "system" address <% $.systemIP %>/32
          - configure system security ssh preserve-key
          - configure system snmp no shutdown
          - configure system snmp packet-size 9216
          - configure system security snmp community private rwa version both
          - configure system security snmp community privatetrap98 rwa version both
          - configure system netconf no shutdown
          - configure system netconf auto-config-save
          - configure system security user "admin" access console netconf
          - configure system security profile "administrative" netconf base-op-authorization lock
          - admin save
          - configure system management-interface configuration-mode model-driven
          - sleep 1
      publish:
        status: <% task().result %>
      on-success:
        - configure_node_md

    configure_node_md:
      action: nsp.sr_cli
      input:
        host: '<% $.mgmtIP %>'
        username: admin
        password: admin
        cmd:
          - /!md-cli
          - configure private
          - system management-interface yang-modules base-r13-modules false
          - system management-interface yang-modules nokia-modules false
          - system management-interface yang-modules nokia-combined-modules true
          - system management-interface yang-modules openconfig-modules true
          - commit

...
